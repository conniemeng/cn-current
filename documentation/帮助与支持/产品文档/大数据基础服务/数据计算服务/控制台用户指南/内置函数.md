**内置函数**

数据计算服务提供以下内建UDF:

* 
## **Mathematical Functions（数学函数）**

以下是Hive支持的内置函数，其中绝大多数函数当入参为NULL时，返回值也为NULL:
**Return Type**

返回值类型

**Name (Signature)**

函数名称

**Description**

函数描述DOUBLE


round(DOUBLE a)

Returns the rounded

BIGINT
value of

a
.

将DOUBLE类型的参数a四舍五入转化为BIGINT类型，并返回。

例如：

select round(3.1415);返回：3

select round(3.5415);返回：4DOUBLE

round(DOUBLE a, INT d)

Returns

a
rounded to

d
decimal places.

将DOUBLE类型的参数a，四舍五入保留d位小数，并返回。

例如：

select round(3.1415,2);返回：3.14

select round(3.1415,3);返回：3.142DOUBLEbround(DOUBLE a)
Returns the rounded BIGINT value of

a
using HALF_EVEN rounding mode (as of [Hive 1.3.0, 2.0.0](https://issues.apache.org/jira/browse/HIVE-11103)). Also known as Gaussian rounding or bankers' rounding. Example: bround(2.5) = 2, bround(3.5) = 4.

使用HALF_EVEN，也称为高斯四舍五入”或“银行家四舍五入”近似规则（针对Hive 1.3.0,2.0.0）,将DOUBLE类型的入参a转化为整数，并返回。

例如：

select bround(2.5);返回：2

select bround(3.5);返回：4DOUBLEbround(DOUBLE a, INT d)
Returns

a
rounded to

d
decimal places using HALF_EVEN rounding mode (as of [Hive 1.3.0, 2.0.0](https://issues.apache.org/jira/browse/HIVE-11103)). Example: bround(8.25, 1) = 8.2, bround(8.35, 1) = 8.4.

使用HALF_EVEN近似规则（针对Hive 1.3.0,2.0.0）,将DOUBLE类型的入参a保留d位小数，并返回。

例如：

select bround(8.25, 1);返回：8.2

select bround(8.35, 1);返回：8.4BIGINT

floor(DOUBLE a)

Returns the maximum

BIGINT
value that is equal to or less than

a
.

返回等于或小于DOUBLE类型入参a的最大整数值。

例如：select floor(3.124);返回：3BIGINT

ceil(DOUBLE a), ceiling(DOUBLE a)

Returns the minimum BIGINT value that is equal to or greater than

a
.

返回等于或大于DOUBLE类型入参a的最小整数值。

例如：

select ceil(3.14);返回：4
select ceiling(3.34);返回：4DOUBLE

rand(), rand(INT seed)

Returns a random number (that changes from row to row) that is distributed uniformly from 0 to 1. Specifying the seed will make sure the generated random number sequence is deterministic.

返回一个从0到1均匀分布的随机数(从行到行的变化)。指定种子将确保生成的随机数序列是确定性的。

例如：

select rand();返回：随机数 0.47890101550569797

select rand(223);多次执行返回相同结果：随机数 0.27309544018185783DOUBLE

exp(DOUBLE a), exp(DECIMAL a)

Returns

ea
where

e
is the base of the natural logarithm. Decimal version added in [Hive 0.13.0](https://issues.apache.org/jira/browse/HIVE-6327).

返回ea
，e是自然对数的底数。Hive 0.13.0中添加了十进制版本的幂计算。

例如：

select exp(1);返回：2.718281828459045

select exp(2);返回：7.38905609893065

select exp(2.5);返回：12.182493960703473

select exp(0.1);返回：1.1051709180756477DOUBLE

ln(DOUBLE a), ln(DECIMAL a)

Returns the natural logarithm of the argument

a
. Decimal version added in [Hive 0.13.0](https://issues.apache.org/jira/browse/HIVE-6327).

返回参数a的自然对数。Hive 0.13.0中添加了十进制版本。

例如：

select ln(e());返回：1

select ln(10);返回：2.302585092994046

select ln(10.5);返回：2.3513752571634776DOUBLE

log10(DOUBLE a), log10(DECIMAL a)

Returns the base-10 logarithm of the argument

a
. Decimal version added in [Hive 0.13.0](https://issues.apache.org/jira/browse/HIVE-6327).

返回以10为底的a的对数。Hive 0.13.0中添加了十进制版本。

例如：

select log10(10);返回：1

select log10(110);返回：2.041392685158225

select log10(110.2);返回：2.042181594515766DOUBLE

log2(DOUBLE a), log2(DECIMAL a)

Returns the base-2 logarithm of the argument

a
. Decimal version added in [Hive 0.13.0](https://issues.apache.org/jira/browse/HIVE-6327).

返回以2为底的a的对数。Hive 0.13.0中添加了十进制版本。

例如：

select log2(2);返回：1

select log2(20);返回：4.321928094887363

select log2(20.7);返回：4.371558862611963DOUBLE

log(DOUBLE base, DOUBLE a)

log(DECIMAL base, DECIMAL a)

Returns the base-

base
logarithm of the argument

a
. Decimal versions added in [Hive 0.13.0](https://issues.apache.org/jira/browse/HIVE-6327).

返回以base为底a的对数。Hive 0.13.0中添加了十进制版本。

例如：

select log(e(),e());返回：1

select log(10.4,10.3);返回：0.9958741622015053

select log(19,26);返回：1.106525406392982DOUBLE

pow(DOUBLE a, DOUBLE p), power(DOUBLE a, DOUBLE p)

Returns

ap
.

返回以a的p次幂。

例如（power函数结果一样）：

select pow(2,3);返回：8

select pow(2.1,3.1);返回：9.97423999265871DOUBLE

sqrt(DOUBLE a), sqrt(DECIMAL a)

Returns the square root of

a
. Decimal version added in [Hive 0.13.0](https://issues.apache.org/jira/browse/HIVE-6327).

返回a的平方根。Hive 0.13.0中添加了小数版本对数计算。Hive 0.13.0中添加了十进制版本。

例如：

select sqrt(4);返回：2

select sqrt(4.7);返回：2.16794833886788STRING

bin(BIGINT a)

Returns the number in binary format (see [http://dev.mysql.com/doc/refman/5.0/en/string-functions.html/#function_bin](http://dev.mysql.com/doc/refman/5.0/en/string-functions.html#function_bin)).

返回a的二进制格式的字符串（详见[http://dev.mysql.com/doc/refman/5.0/en/string-functions.html/#function_bin](http://dev.mysql.com/doc/refman/5.0/en/string-functions.html#function_bin)）

例如：select bin(7);返回：111STRING

hex(BIGINT a) hex(STRING a) hex(BINARY a)

If the argument is an

INT
or

binary
,

hex
returns the number as a

STRING
in hexadecimal format. Otherwise if the number is a

STRING
, it converts each character into its hexadecimal representation and returns the resulting

STRING
. (See [http://dev.mysql.com/doc/refman/5.0/en/string-functions.html/#function_hex](http://dev.mysql.com/doc/refman/5.0/en/string-functions.html#function_hex),

BINARY
version as of Hive [0.12.0](https://issues.apache.org/jira/browse/HIVE-2482).)

如果参数是整型或二进制，返回参数的十六进制格式字符串。如果入参是字符串，将每个字符转换成它的十六进制表示，并返回结果字符串。（详见[http://dev.mysql.com/doc/refman/5.0/en/string-functions.html/#function_hex](http://dev.mysql.com/doc/refman/5.0/en/string-functions.html#function_hex),

BINARY
version as of Hive [0.12.0](https://issues.apache.org/jira/browse/HIVE-2482).）

例如：select hex(107),hex('k'),hex('A'),hex(bin(7));返回：6B 6B 41 313131BINARY

unhex(STRING a)

Inverse of hex. Interprets each pair of characters as a hexadecimal number and converts to the byte representation of the number. (

BINARY
version as of Hive [0.12.0](https://issues.apache.org/jira/browse/HIVE-2482), used to return a string.)

将每一对字符解释为十六进制数，并转换为数字的字节表示。

（Hive 0.12.0的二进制版本，返回字符串格式）。

例如：select unhex('6B'),unhex('41'),unhex('313131');返回：aw== QQ== MTExSTRING

conv(BIGINT num, INT from_base, INT to_base), conv(STRING num, INT from_base, INT to_base)

Converts a number from a given base to another (see [http://dev.mysql.com/doc/refman/5.0/en/mathematical-functions.html/#function_conv](http://dev.mysql.com/doc/refman/5.0/en/mathematical-functions.html#function_conv)).

将入参数字从一个给定的基转换成另一个基(详见[http://dev.mysql.com/doc/refman/5.0/en/mathematical-functions.html/#function_conv](http://dev.mysql.com/doc/refman/5.0/en/mathematical-functions.html#function_conv))。

例如：select conv(111,2,10);（将111从2进制转换成10进制）返回：7DOUBLE

abs(DOUBLE a)

Returns the absolute value

返回a的绝对值。

例如：select abs(-32.423);返回32.423INT or DOUBLE

pmod(INT a, INT b), pmod(DOUBLE a, DOUBLE b)

Returns the positive value of

a mod b
.

返回a对b取模的正值。

例如：select pmod(7,2);返回：1DOUBLE

sin(DOUBLE a), sin(DECIMAL a)

Returns the sine of

a
(

a
is in radians). Decimal version added in [Hive 0.13.0](https://issues.apache.org/jira/browse/HIVE-6327).

返回a的sin值，其中a用弧度制表示。Hive 0.13.0中添加了十进制版本。

例如：select sin(pi()/6);返回：0.49999999999999994DOUBLE

asin(DOUBLE a), asin(DECIMAL a)

Returns the arc sin of

a
if -1<=a<=1 or NULL otherwise. Decimal version added in [Hive 0.13.0](https://issues.apache.org/jira/browse/HIVE-6327).

如果 -1<=a<=1，返回a的反正弦值，否则返回NULL。Hive 0.13.0中添加了十进制版本。

例如：

select asin(2);返回：NaN

select asin(pi()/6);返回：0.5510695830994463DOUBLE

cos(DOUBLE a), cos(DECIMAL a)

Returns the cosine of

a
(

a
is in radians). Decimal version added in [Hive 0.13.0](https://issues.apache.org/jira/browse/HIVE-6327).

返回a的cos值，其中a用弧度制表示。Hive 0.13.0中添加了十进制版本。

例如：select cos(pi()/3);返回：0.5000000000000001DOUBLE

acos(DOUBLE a), acos(DECIMAL a)

Returns the arccosine of

a
if -1<=a<=1 or NULL otherwise. Decimal version added in [Hive 0.13.0](https://issues.apache.org/jira/browse/HIVE-6327).

如果 -1<=a<=1，返回a的反余弦值，否则返回NULL。Hive 0.13.0中添加了十进制版本。

例如：

select acos(2);返回：NaN

select acos(pi()/6);返回：1.0197267436954502DOUBLE

tan(DOUBLE a), tan(DECIMAL a)

Returns the tangent of

a
(

a
is in radians). Decimal version added in [Hive 0.13.0](https://issues.apache.org/jira/browse/HIVE-6327).

返回a的tan值，其中a用弧度制表示。Hive 0.13.0中添加了十进制版本。

例如：select tan(pi()/4);返回：0.9999999999999999DOUBLE

atan(DOUBLE a), atan(DECIMAL a)

Returns the arctangent of

a
. Decimal version added in [Hive 0.13.0](https://issues.apache.org/jira/browse/HIVE-6327).

返回a的反正切值，其中a用弧度制表示。Hive 0.13.0中添加了十进制版本。

例如：select atan(pi()/4);返回：0.6657737500283538DOUBLE

degrees(DOUBLE a), degrees(DECIMAL a)

Converts value of

a
from radians to degrees. Decimal version added in [Hive 0.13.0](https://issues.apache.org/jira/browse/HIVE-6385).

将a的弧度制变成度数，并返回。Hive 0.13.0中添加了十进制版本。

例如：select degrees(pi());返回：180DOUBLE

radians(DOUBLE a), radians(DOUBLE a)

Converts value of

a
from degrees to radians. Decimal version added in [Hive 0.13.0](https://issues.apache.org/jira/browse/HIVE-6327).

将度数a变成弧度制，并返回。Hive 0.13.0中添加了十进制版本。

例如：select radians(180);返回：3.141592653589793INT or DOUBLE

positive(INT a), positive(DOUBLE a)

Returns

a.

返回a的正值。

例如：

select positive(30);返回：30

select positive(-30);返回：-30INT or DOUBLE

negative(INT a), negative(DOUBLE a)

Returns

-a
.

返回a的负值。

例如：

select negative(3.2);返回：-3.2

select negative(-3.2);返回：3.2DOUBLE or INT

sign(DOUBLE a), sign(DECIMAL a)

Returns the sign of

a
as '1.0' (if

a
is positive) or '-1.0' (if

a
is negative), '0.0' otherwise. The decimal version returns INT instead of DOUBLE. Decimal version added in [Hive 0.13.0](https://issues.apache.org/jira/browse/HIVE-6246).

符号函数，如果a>0，返回1.0；如果a<0，返回-1.0，否则返回0。

例如：

select sign(3.2);返回：1

select sign(0);返回：0

select sign(-3.2);返回：-1DOUBLE

e()

Returns the value of

e
.

返回e的值。

例如：select e();返回：2.718281828459045DOUBLE

pi()

Returns the value of

pi
.

返回pi的值。

例如：select pi();返回：3.141592653589793BIGINTfactorial(INT a)
Returns the factorial of

a
(as of Hive [1.2.0](https://issues.apache.org/jira/browse/HIVE-9857)). Valid

a
is [0..20].

返回a的阶乘(Hive 1.2.0)，a范围是[0,20]。

例如：select factorial(3);返回：6DOUBLEcbrt(DOUBLE a)
Returns the cube root of

a
double value (as of Hive [1.2.0](https://issues.apache.org/jira/browse/HIVE-9858)).

返回a的立方根(Hive 1.2.0)。

例如：select cbrt(8);返回：2INT

BIGINT

shiftleft(TINYINT|SMALLINT|INT a, INT b)

shiftleft(BIGINT a, INT b)

Bitwise left shift (as of Hive [1.2.0](https://issues.apache.org/jira/browse/HIVE-9859)). Shifts

a

b
positions to the left.

Returns int for tinyint, smallint and int

a
. Returns bigint for bigint

a
.

按位左移运算，把a左移b位。

如果输入类型是tinyint，smallint或int，则返回类型为int；如果输入类型是bigint则返回类型为bigint。

例如：select shiftleft(7,1);返回：14INT

BIGINT

shiftright(TINYINT|SMALLINT|INT a, INT b)

shiftright(BIGINT a, INT b)

Bitwise right shift (as of Hive [1.2.0](https://issues.apache.org/jira/browse/HIVE-9859)). Shifts

a

b
positions to the right.

Returns int for tinyint, smallint and int

a
. Returns bigint for bigint

a
.

按位右移运算，把a右移b位。

如果输入类型是tinyint，smallint或int，则返回类型为int；如果输入类型是bigint则返回类型为bigint。

例如：

select shiftright(14,1);返回：7

select shiftright(-14,1);返回：-7INT

BIGINT

shiftrightunsigned(TINYINT|SMALLINT|INT a, INT b),

shiftrightunsigned(BIGINT a, INT b)

Bitwise unsigned right shift (as of Hive [1.2.0](https://issues.apache.org/jira/browse/HIVE-9859)). Shifts

a

b
positions to the right.

Returns int for tinyint, smallint and int

a
. Returns bigint for bigint

a
.

无符号按位右移运算（Hive [1.2.0](https://issues.apache.org/jira/browse/HIVE-9859)），将a向右移动b位。

如果输入类型是tinyint，smallint或int，则返回类型为int；如果输入类型是bigint则返回类型为bigint。

例如：

select shiftrightunsigned(14,1);返回：7

select shiftrightunsigned(-14,1);返回：2147483641Tgreatest(T v1, T v2, ...)
Returns the greatest value of the list of values (as of Hive [1.1.0](https://issues.apache.org/jira/browse/HIVE-9402)). Fixed to return NULL when one or more arguments are NULL, and strict type restriction relaxed, consistent with ">" operator (as of Hive [2.0.0](https://issues.apache.org/jira/browse/HIVE-12082)).

返回值列表的最大值(Hive 1.1.0)。修正当一个或多个参数为空时，返回NULL的问题。严格的类型限制放宽，与“>”运算符一致(Hive 2.0.0)。

例如：select greatest(1,2,6,9,4,null,null);返回：9Tleast(T v1, T v2, ...)
Returns the least value of the list of values (as of Hive [1.1.0](https://issues.apache.org/jira/browse/HIVE-9402)). Fixed to return NULL when one or more arguments are NULL, and strict type restriction relaxed, consistent with "<" operator (as of Hive [2.0.0](https://issues.apache.org/jira/browse/HIVE-12082)).

返回值列表的最小值(Hive 1.1.0)。修正当一个或多个参数为空时，返回NULL的问题。严格的类型限制放宽，与“<”运算符一致(Hive 2.0.0)。

例如：select least(1,2,6,9,4,null,null);返回：1INTwidth_bucket(NUMERIC expr, NUMERIC min_value, NUMERIC max_value, INT num_buckets)
Returns an integer between 0 and num_buckets+1 by mapping expr into the ith equally sized bucket. Buckets are made by dividing [min_value, max_value] intoequally sized regions. If expr < min_value, return 1, if expr > max_value return num_buckets+1. See[https://docs.oracle.com/cd/B19306_01/server.102/b14200/functions214.htm](https://docs.oracle.com/cd/B19306_01/server.102/b14200/functions214.htm)(as of Hive 3.0.0)

将expr映射到第i个同样大小的bucket中，返回0和num_bucket + 1之间的整数。通过将[min_value,max_value]划分为大小相等的区域来进行存储。如果expr < min_value，返回1，如果expr > max_value返回num_bucket + 1。

（详见[https://docs.oracle.com/cd/B19306_01/server.102/b14200/functions214.htm](https://docs.oracle.com/cd/B19306_01/server.102/b14200/functions214.htm)(Hive 3.0.0)）

数据计算服务中当前版本暂不支持。

* 
### Mathematical Functions and Operators for Decimal Datatypes（十进制数据类型的数学函数和运算符）

Hive 0.11.0(Hive - 2693)中引入了十进制数据类型。

所有常规算术运算符(例如+、-、/*、/)和相关的数学udf(Floor, Ceil, Round等)都被更新以处理十进制类型。

有关支持的udf的列表，请参阅Hive数据类型中的数学udf。

* 
### Collection Functions（集合函数）

在Hive中支持以下内置的集合函数:
**Return Type**

返回值

**Name(Signature)**

函数名称

**Description**

函数描述int

size(Map<K.V>)

Returns the number of elements in the map type.

获得MAP长度。

例如：select size(map(1, 'abc', 2, 'cde')); 返回：2int

size(Array<T>)

Returns the number of elements in the array type.

获得数组长度。

例如：select size(array(1, 2)); 返回：2array<K>

map_keys(Map<K.V>)

Returns an unordered array containing the keys of the input map.

返回包含输入MAP键的无序数组。

例如：select map_keys(map(1, 'a', 2, 'b')); 返回：[1,2]array<V>

map_values(Map<K.V>)

Returns an unordered array containing the values of the input map.

返回包含输入MAP值的无序数组。

例如：select map_values(map(1, 'a', 2, 'b')); 返回：["a","b"]boolean

array_contains(Array<T>, value)

Returns TRUE if the array contains value.

判断指定数组中是否包含value元素，包含则返回true，反之则false。

例如：select array_contains(array('a', 2), 'b'); 返回：falsearray<t>

sort_array(Array<T>)

Sorts the input array in ascending order according to the natural ordering of the array elements and returns it (as of version [0.9.0](https://issues.apache.org/jira/browse/HIVE-2279)).

根据数组元素的自然顺序，升序排序。

例如：

select sort_array(array('a', 2)); 返回 ： ["2","a"]

select sort_array(array('a', '汉字', 'b')); 返回：["a","b","汉字"]

* 
### Type Conversion Functions（类型转换函数）

在Hive中支持以下类型转换函数:

Return Type

返回值类型

Name(Signature)

函数名称

Description

函数描述binary

binary(string|binary)

Casts the parameter into a binary.将入参转换为二进制文件。

改函数可以将string或者是binary(二进制数据类型)转换为binary(二进制数据类型)**Expected "=" to follow "type"**

cast(expr as <type>)

Converts the results of the expression expr to <type>. For example, cast('1' as BIGINT) will convert the string '1' to its integral representation. A null is returned if the conversion does not succeed. If cast(expr as boolean) Hive returns true for a non-empty string.

将表达式expr的结果转换为< type >。例如，cast(' 1 '作为BIGINT) cast(1 as BIGINT)把字符串' 1 '转换成它的整数表示形式。如果转换不成功，则返回null。对于非空字符串，Hive返回true。

* 
### Date Functions（日期函数）

在Hive中支持以下内置日期函数:

**Return Type**

返回值类型

**Name(Signature)**

函数名称

**Description**

函数描述string

from_unixtime(bigint unixtime[, string format])

Converts the number of seconds from unix epoch (1970-01-01 00:00:00 UTC) to a string representing the timestamp of that moment in the current system time zone in the format of "1970-01-01 00:00:00".

将从unix时代纪元时间(1970 -01-01 00:00 UTC)向后经过的秒数转换为表示当前系统时区的时间戳的字符串，格式为“1970 -01-01 00:00”。bigint

unix_timestamp()

Gets current Unix timestamp in seconds. This function is not deterministic and its value is not fixed for the scope of a query execution, therefore prevents proper optimization of queries - this has been deprecated since 2.0 in favour of CURRENT_TIMESTAMP constant.

以秒为单位获得当前的Unix时间戳。这个函数不是确定性的，它的值不是针对查询执行的范围而定的，因此可以防止对查询进行适当的优化——这在2.0支持CURRENT_TIMESTAMP常数的情况下就被弃用了。

在一个查询执行范围内该函数的值不是固定的, 因此阻碍了对查询进行适当的优化-在2.0及之后的版本中支持CURRENT_TIMESTAMP常数,该函数已经被启用。bigint

unix_timestamp(string date)

Converts time string in format

yyyy-MM-dd HH:mm:ss
to Unix timestamp (in seconds), using the default timezone and the default locale, return 0 if fail: unix_timestamp('2009-03-20 11:30:01') = 1237573801

将时间字符串转换成yyyy - mm -dd HH:mm:ss到Unix时间戳(以秒为单位)，将格式为yyyy - mm -dd HH:mm:ss的字符串转换为Unix时间戳(以秒为单位), 使用默认时区和默认语言环境，如果失败，返回0，unix_timestamp(' 2009-03-20 11:30:01 ')= 1237573801。bigint

unix_timestamp(string date, string pattern)

Convert time string with given pattern (see [[http://docs.oracle.com/javase/tutorial/i18n/format/simpleDateFormat.html](http://docs.oracle.com/javase/tutorial/i18n/format/simpleDateFormat.html)]) to Unix time stamp (in seconds), return 0 if fail: unix_timestamp('2009-03-20', 'yyyy-MM-dd') = 1237532400.

将给定模式的时间字符串（详见[http://docs.oracle.com/javase/tutorial/i18n/format/simpleDateFormat.html](http://docs.oracle.com/javase/tutorial/i18n/format/simpleDateFormat.html)）转换为Unix时间戳(以秒为单位)，如果失败，返回0，unix_timestamp("2009-03-20", "yyyy-mm-dd") = 1237532400。*pre 2.1.0:* string
*2.1.0 on:* date
to_date(string timestamp)

Returns the date part of a timestamp string (pre-Hive 2.1.0): to_date("1970-01-01 00:00:00") = "1970-01-01". As of Hive 2.1.0, returns a date object.

返回时间戳字符串的日期(pre - hive 2.1.0):to_date(“1970 -01-01 00:00”)=“1970 -01- 01”。在Hive 2.1.0中，返回一个日期对象。

Prior to Hive 2.1.0 ([HIVE-13248](https://issues.apache.org/jira/browse/HIVE-13248)) the return type was a String because no Date type existed when the method was created.

在Hive 2.1.0(Hive - 13248)之前，返回类型是一个字符串，因为在创建方法时没有日期类型。

在spark-2.2.0版本中, 该函数返回值为data类型, 且参数timestamp可以是string类型, timestamp类型, date类型, 如果是string类型, string前缀需符合'yyyy-mm-dd', 例如: to_date('1970-01-01 abc') = '1970-01-01'。int

year(string date)

Returns the year part of a date or a timestamp string: year("1970-01-01 00:00:00") = 1970, year("1970-01-01") = 1970.

返回年份的日期或时间戳字符串: year("1970 -01-01 00:00:00")= 1970年，year("1970-01-01")= 1970年。

在spark-2.2.0版本中, 该函数参数类型可以为string, timestamp, date。int
quarter(date/timestamp/string)
Returns the quarter of the year for a date, timestamp, or string in the range 1 to 4 (as of Hive [1.3.0](https://issues.apache.org/jira/browse/HIVE-3404)). Example: quarter('2015-04-08') = 2.

在1到4的范围内返回1 / 4的年份、时间戳或字符串(如Hive 1.3.0)。例子:quarter('2015-04-08')= 2。int

month(string date)

Returns the month part of a date or a timestamp string: month("1970-11-01 00:00:00") = 11, month("1970-11-01") = 11.

返回日期或时间戳字符串的月数: month(“1970 -11-01 00:00”)= 11，month(“1970-11-01”)= 11。

在spark-2.2.0版本中, 该函数参数类型可以为string, timestamp, date。int

day(string date) dayofmonth(date)

Returns the day part of a date or a timestamp string: day("1970-11-01 00:00:00") = 1, day("1970-11-01") = 1.

返回日期或时间戳字符串的天数字段: day(“1970-11-01 00:00”)= 1,day(“1970-11-01”)= 1。

在spark-2.2.0版本中, 该函数参数类型可以为string, timestamp, date。int

hour(string date)

Returns the hour of the timestamp: hour('2009-07-30 12:58:59') = 12, hour('12:58:59') = 12.

返回时间戳的小时数: hour("2009-07-30 12:58:59")= 12，hour("12:58:59")= 12。

在spark-2.2.0版本中, 该函数参数类型可以为string, timestamp。int

minute(string date)

Returns the minute of the timestamp.

返回时间戳的分钟数。

在spark-2.2.0版本中, 该函数参数类型可以为string, timestamp。int

second(string date)

Returns the second of the timestamp.

返回时间戳的秒数。

在spark-2.2.0版本中, 该函数参数类型可以为string, timestamp。int

weekofyear(string date)

Returns the week number of a timestamp string: weekofyear("1970-11-01 00:00:00") = 44, weekofyear("1970-11-01") = 44.

返回一个时间戳字符串的星期数:weekofyear("1970-11-01 00:00:00")= 44,weekofyear("1970-11-01")= 44。

在spark-2.2.0版本中, 该函数参数类型可以为string, timestamp, date。int
extract(field FROM source)

Retrieve fields such as days or hours from source (as of Hive [2.2.0](https://issues.apache.org/jira/browse/HIVE-14579)). Source must be a date, timestamp, interval or a string that can be converted into either a date or timestamp. Supported fields include: day, dayofweek, hour, minute, month, quarter, second, week and year.

从源(Hive 2.2.0)中检索天数或小时数的字段。源必须是一个日期、时间戳、间隔或可以转换成日期或时间戳的字符串。受支持的领域包括:日、一周中的第几天、小时、分、月、季度、秒、周、年。

Examples:

1. 
select extract(month from "2016-10-20") results in 10.
1. 
select extract(hour from "2016-10-20 05:06:07") results in 5.
1. 
select extract(dayofweek from "2016-10-20 05:06:07") results in 5.
1. 
select extract(month from interval '1-3' year to month) results in 3.
1. 
select extract(minute from interval '3 12:20:30' day to second) results in 20.

例子：

1.提取月： extract(month from "2016-10-20") ，结果是10.

2.提取小时：extract(hour from "2016-10-20 05:06:07") 结果是5.

3.提出一周中的第几天：extract(dayofweek from "2016-10-20 05:06:07") 结果是5.

4.提取月数：extract(month from interval '1-3' year to month) 结果是3.

5.提取分钟数：extract(minute from interval '3 12:20:30' day to second)结果是20.

在spark-2.2.0版本中, 不支持该函数.int

datediff(string enddate, string startdate)

Returns the number of days from startdate to enddate: datediff('2009-03-01', '2009-02-27') = 2.

返回startdate到enddate的天数:datediff("2009-03-01", "2009-02-27")= 2。

在spark-2.2.0版本中, 该函数参数类型可以为string, timestamp, date。*pre 2.1.0:* string
*2.1.0 on:* date
date_add(date/timestamp/string startdate, tinyint/smallint/int days)

Adds a number of days to startdate: date_add('2008-12-31', 1) = '2009-01-01'.

添加指定天数：startdate: date_add("2008-12-31", 1) = '2009-01-01 '。

Prior to Hive 2.1.0 ([HIVE-13248](https://issues.apache.org/jira/browse/HIVE-13248)) the return type was a String because no Date type existed when the method was created.

Hive 2.1.0(Hive - 13248)之前，返回类型是一个字符串，因为在创建方法时没有日期类型。

在spark-2.2.0版本中, 该函数返回值类型为date。*pre 2.1.0:* string
*2.1.0 on:* date
date_sub(date/timestamp/string startdate, tinyint/smallint/int days)

Subtracts a number of days to startdate: date_sub('2008-12-31', 1) = '2008-12-30'.

减少指定天数：startdate:date_add(“2008 -12- 31”，1)= '2009-01-01 '。

Prior to Hive 2.1.0 ([HIVE-13248](https://issues.apache.org/jira/browse/HIVE-13248)) the return type was a String because no Date type existed when the method was created.

Hive 2.1.0(Hive - 13248)之前，返回类型是一个字符串，因为在创建方法时没有日期类型。

在spark-2.2.0版本中, 该函数返回值类型为date。timestamp

from_utc_timestamp({any primitive type}/*, string timezone)

Coverts a timestamp/* in UTC to a given timezone (as of Hive [0.8.0](https://issues.apache.org/jira/browse/HIVE-2272)). /* timestamp is a primitive type, including timestamp/date, tinyint/smallint/int/bigint, float/double and decimal. Fractional values are considered as seconds. Integer values are considered as milliseconds.. E.g from_utc_timestamp(2592000.0,'PST'), from_utc_timestamp(2592000000,'PST') and from_utc_timestamp(timestamp '1970-01-30 16:00:00','PST') all return the timestamp 1970-01-30 08:00:00

将时间戳在UTC中覆盖到给定的时区(Hive 0.8.0)。时间戳是一个原始类型,包括时间戳/日期,极小整型/短整型/ 整形 /长整型数字,浮点型/双精度浮点型和小数。分数值被认为是秒。整数值被认为是毫秒。

例如：gfrom_utc_timestamp(2592000.0,PST)，from_utc_timestamp(2592000000,PST)和from_utc_timestamp(timestamp '1970-01-30 16:00 '，'PST ')，全部返回时间戳1970 -01-30 08:00

在spark-2.2.0版本中, 该函数第一个参数必须为timestamp类型, 例如:from_utc_timestamp(current_timestamp, 'Asia/Shanghai'), from_utc_timestamp(timestamp '1970-01-30 16:00:00', 'Asia/Shanghai')。timestamp

to_utc_timestamp({any primitive type} ts, string timezone)

Coverts a timestamp/* in a given timezone to UTC (as of Hive [0.8.0](https://issues.apache.org/jira/browse/HIVE-2272)). /* timestamp is a primitive type, including timestamp/date, tinyint/smallint/int/bigint, float/double and decimal. Fractional values are considered as seconds. Integer values are considered as milliseconds.. E.g to_utc_timestamp(2592000.0,'PST'), to_utc_timestamp(2592000000,'PST') and to_utc_timestamp(timestamp '1970-01-30 16:00:00','PST') all return the timestamp 1970-01-31 00:00:00

在时间转化成时间戳(Hive 0.8.0)。时间戳是一个原始类型,包括时间戳/日期,极小整型/短整型/ 整形 /长整型数字,浮点型/双精度浮点型和小数。分数值被认为是秒。整数值被认为是毫秒。

例如：to_utc_timestamp(2592000.0，'PST ')，to_utc_timestamp(2592000000,PST ')和to_utc_timestamp(timestamp '1970-01-30 16:00 '，'PST ')，均返回时间戳1970 -01-31 00:00

在spark-2.2.0版本中, 该函数第一个参数必须为timestamp类型, 例如: to_utc_timestamp(current_timestamp, 'Asia/Shanghai'), to_utc_timestamp(timestamp '1970-01-30 16:00:00', 'Asia/Shanghai')。datecurrent_date
Returns the current date at the start of query evaluation (as of Hive [1.2.0](https://issues.apache.org/jira/browse/HIVE-5472)). All calls of current_date within the same query return the same value.

返回查询时的当前日期(Hive 1.2.0)，在同一个查询中current_date返回相同的值。timestampcurrent_timestamp
Returns the current timestamp at the start of query evaluation (as of Hive [1.2.0](https://issues.apache.org/jira/browse/HIVE-5472)). All calls of current_timestamp within the same query return the same value.

返回查询时的当前时间戳(Hive 1.2.0)，在同一个查询中current_date返回相同的值。stringadd_months(string start_date, int num_months)
Returns the date that is num_months after start_date (as of Hive [1.1.0](https://issues.apache.org/jira/browse/HIVE-9357)). start_date is a string, date or timestamp. num_months is an integer. The time part of start_date is ignored. If start_date is the last day of the month or if the resulting month has fewer days than the day component of start_date, then the result is the last day of the resulting month. Otherwise, the result has the same day component as start_date.

返回start_date之后num_months的日期(Hive 1.1.0)。start_date是一个字符串、日期或时间戳。num_months是整数。start_date的时间部分被忽略。如果start_date是一个月的最后一天，或者生成的月份比start_date的天数少，那么结果就是最后一个月的最后一天。否则，与start_date同一天。stringlast_day(string date)
Returns the last day of the month which the date belongs to (as of Hive [1.1.0](https://issues.apache.org/jira/browse/HIVE-9358)). date is a string in the format 'yyyy-MM-dd HH:mm:ss' or 'yyyy-MM-dd'. The time part of date is ignored.

返回日期所属的月份的最后一天(Hive 1.1.0)。

日期是格式“yyyy-mm-dd HH:mm:ss”或“yyyy-mm-dd”的字符串。日期的时间部分被忽略。

在spark-2.2.0版本中, 该函数的参数类型可以为string, date, timestamp。stringnext_day(string start_date, string day_of_week)
Returns the first date which is later than start_date and named as day_of_week (as of Hive [1.2.0](https://issues.apache.org/jira/browse/HIVE-9520)). start_date is a string/date/timestamp. day_of_week is 2 letters, 3 letters or full name of the day of the week (e.g. Mo, tue, FRIDAY). The time part of start_date is ignored. Example: next_day('2015-01-14', 'TU') = 2015-01-20.

返回start_date之后day_of_week的日期(Hive 1.2.0)。

start_date为一个字符串/日期/时间戳。day_of_week是2个字母，3个字母或周几的全称(如Mo,tue，周五)。start_date的时间部分被忽略。

例如:next_day('2015-01-14', 'TU')= 2015-01-20。

day_of_week是周几的前2个字母或前3个字母或全称, 不区分大小写, 例如: "MO", "TU", "WE", "TH", "FR", "SA" , "SU", "MON", "TUE", "WED", "THU", "FRI", "SAT", "SUN", "MONDAY", "TUESDAY", "WEDNESDAY", "THURSDAY", "FRIDAY", "SATURDAY", "SUNDAY"stringtrunc(string date, string format)
Returns date truncated to the unit specified by the format (as of Hive [1.2.0](https://issues.apache.org/jira/browse/HIVE-9480)). Supported formats: MONTH/MON/MM, YEAR/YYYY/YY. Example: trunc('2015-03-17', 'MM') = 2015-03-01.

返回被指定格式截断后的日期(Hive 1.2.0)，支持格式:MONTH/MON/MM, YEAR/YYYY/YY, 不区分大小写。

例如: trunc('2015-03-17', 'MM') = 2015-03-01。

在spark-2.2.0版本中, 该函数的参数类型可以为string, date, timestamp。doublemonths_between(date1, date2)
Returns number of months between dates date1 and date2 (as of Hive [1.2.0](https://issues.apache.org/jira/browse/HIVE-9518)). If date1 is later than date2, then the result is positive. If date1 is earlier than date2, then the result is negative. If date1 and date2 are either the same days of the month or both last days of months, then the result is always an integer. Otherwise the UDF calculates the fractional portion of the result based on a 31-day month and considers the difference in time components date1 and date2. date1 and date2 type can be date, timestamp or string in the format 'yyyy-MM-dd' or 'yyyy-MM-dd HH:mm:ss'. The result is rounded to 8 decimal places. Example: months_between('1997-02-28 10:30:00', '1996-10-30') = 3.94959677

返回date date1和date2日期之间的月数(Hive 1.2.0)。

如果date1比date2晚，那么结果是正数。如果date1比date2早，则结果为负。如果date1和date2不是在一个月的同一天，或者是两个月的最后几天，那么结果总是一个整数。否则，UDF根据一个31天的月计算结果的小数部分，结果四舍五入到小数点后8位。

date1和date2类型可以是日期、时间戳或字符串格式的“yyyy-mm-dd”或“yyyy-mm-dd HH:mm:ss”。

例如: months_between('1997-02-28 10:30:00', '1996-10-30') = 3.94959677。stringdate_format(date/timestamp/string ts, string fmt)
Converts a date/timestamp/string to a value of string in the format specified by the date format fmt (as of Hive [1.2.0](https://issues.apache.org/jira/browse/HIVE-10276)). Supported formats are Java SimpleDateFormat formats – [https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html](https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html). The second argument fmt should be constant. Example: date_format('2015-04-08', 'y') = '2015'.

date_format can be used to implement other UDFs, e.g.:

* 
dayname(date) is date_format(date, 'EEEE')
* 
dayofyear(date) is date_format(date, 'D')
将日期/时间戳/字符串转换为日期格式fmt(Hive 1.2.0)指定格式的字符串值。
支持的格式是 Java SimpleDateFormat——[https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html。]()第二个参数fmt应该是常量。例如:date_format(' 2015-04-08 '，' y ')= '2015 '。
另外 date_format 也可以用于实现其他内置功能函数例如：
* 
dayname(date)等价于 date_format(date, 'EEEE')；
* 
dayofyear(date) 等价于date_format(date, 'D')。

* 
### Conditional Functions
**Return Type**

**Name(Signature)**

**Description**T

if(boolean testCondition, T valueTrue, T valueFalseOrNull)

Returns valueTrue when testCondition is true, returns valueFalseOrNull otherwise.

当testCondition为true时返回True，否则返回False或者Null。booleanisnull( a )
Returns true if a is NULL and false otherwise.

如果a是NULL则返回true，否则返回false。booleanisnotnull ( a )
Returns true if a is not NULL and false otherwise.

如果a不是NULL则返回true，否则返回false。Tnvl(T value, T default_value)
Returns default value if value is null else returns value (as of HIve [0.11](https://issues.apache.org/jira/browse/HIVE-2288)).

如果value为null，返回default_value，否则返回value(HIve 0.11)。T

COALESCE(T v1, T v2, ...)

Returns the first v that is not NULL, or NULL if all v's are NULL.

如果v不是NULL则返回v，如果v1, v2...均为NULL，则返回NULL。T

CASE a WHEN b THEN c [WHEN d THEN e]/* [ELSE f] END

When a = b, returns c; when a = d, returns e; else returns f.

当a=b时，返回c;当a=d时，返回e;否则返回f。T

CASE WHEN a THEN b [WHEN c THEN d]/* [ELSE e] END

When a = true, returns b; when c = true, returns d; else returns e.

当a=true时，返回b; 当c=true时，返回d;否则返回 e。Tnullif( a, b )
Returns NULL if a=b; otherwise returns a (as of Hive [2.2.0](https://issues.apache.org/jira/browse/HIVE-13555)).

Shorthand for: CASE WHEN a = b then NULL else a

如果a=b, 返回NULL；否则返回 a (Hive [2.2.0](https://issues.apache.org/jira/browse/HIVE-13555))；

缩写：CASE WHEN a = b then NULL else a。voidassert_true(boolean condition)
Throw an exception if 'condition' is not true, otherwise return null (as of Hive [0.8.0](https://issues.apache.org/jira/browse/HIVE-2532)). For example, select assert_true (2<1).

如果condition为假，则抛出异常，否则返回null(Hive 0.8.0)。例如，选择select assert_true (2<1)。

* 
### String Functions

在Hive中支持以下内置日期函数:
**Return Type**

**Name(Signature)**

**Description**int

ascii(string str)

Returns the numeric value of the first character of str.

返回str的第一个字符的数值。string

base64(binary bin)

Converts the argument from binary to a base 64 string (as of Hive [0.12.0](https://issues.apache.org/jira/browse/HIVE-2482)).

将bin从二进制转换为base 64字符串(Hive 0.12.0)。intcharacter_length(string str)
Returns the number of UTF-8 characters contained in str (as of Hive [2.2.0](https://issues.apache.org/jira/browse/HIVE-15979)). The function char_length is shorthand for this function.

返回 str 中包含的utf - 8字符数量 (Hive 2.2.0)。char_length是这个函数的简写。stringchr(bigint|double A)
Returns the ASCII character having the binary equivalent to A (as of Hive [1.3.0 and 2.1.0](https://issues.apache.org/jira/browse/HIVE-13063)). If A is larger than 256 the result is equivalent to chr(A % 256). Example: select chr(88); returns "X".

返回二进制为A 的 ASCII字符 (Hive 1.3.0和2.1.0)。如果A大于256，结果等于chr(A % 256)。例如:选择对应(88);返回“X”。string

concat(string|binary A, string|binary B...)

Returns the string or bytes resulting from concatenating the strings or bytes passed in as parameters in order. For example, concat('foo', 'bar') results in 'foobar'. Note that this function can take any number of input strings.

返回字符串或字节作为入参的顺序链接的字符串或字节。例如，concat(' foo '，' bar ')的结果是' foobar '。注意，这个函数可以接受任意数量的输入字符串。array<struct<string,double>>

context_ngrams(array<array<string>>, array<string>, int K, int pf)

Returns the top-k contextual N-grams from a set of tokenized sentences, given a string of "context". See [StatisticsAndDataMining](https://cwiki.apache.org/confluence/display/Hive/StatisticsAndDataMining) for more information.

从一组token化句子中返回上下文中最前面连续出现的N个语词。有关更多信息，请参阅统计数据挖掘。string

concat_ws(string SEP, string A, string B...)

Like concat() above, but with custom separator SEP.

与上面的concat()类似，但是使用自定义分隔符SEP。string

concat_ws(string SEP, array<string>)

Like concat_ws() above, but taking an array of strings. (as of Hive [0.9.0](https://issues.apache.org/jira/browse/HIVE-2203))

和上面的concat_ws()一样，但是要获取字符串数组。(Hive [0.9.0](https://issues.apache.org/jira/browse/HIVE-2203))。string

decode(binary bin, string charset)

Decodes the first argument into a String using the provided character set (one of 'US-ASCII', 'ISO-8859-1', 'UTF-8', 'UTF-16BE', 'UTF-16LE', 'UTF-16'). If either argument is null, the result will also be null. (As of Hive [0.12.0](https://issues.apache.org/jira/browse/HIVE-2482).)

使用提供的字符集(“us - ascii”，“iso -8859- 1”，“utf - 8”，“utf - 16”，“utf - 16le”，“utf - 16”)，将 bin 解码为字符串。如果任一参数为空，则结果也为空。(如蜂巢0.12.0。)stringelt(N int,str1 string,str2 string,str3 string,...)
Return string at index number. For example elt(2,'hello','world') returns 'world'. Returns NULL if N is less than 1 or greater than the number of arguments.

(see [https://dev.mysql.com/doc/refman/5.7/en/string-functions.html/#function_elt](https://dev.mysql.com/doc/refman/5.7/en/string-functions.html#function_elt))

返回字符串的索引号。例如，elt(2，' hello'，'world ')，返回' world '。如果N小于1或大于参数数，则返回NULL。

(见[https://dev.mysql.com/doc/refman/5.7/en/string-functions.html](https://dev.mysql.com/doc/refman/5.7/en/string-functions.html) function_elt)。binary

encode(string src, string charset)

Encodes the first argument into a BINARY using the provided character set (one of 'US-ASCII', 'ISO-8859-1', 'UTF-8', 'UTF-16BE', 'UTF-16LE', 'UTF-16'). If either argument is null, the result will also be null. (As of Hive [0.12.0](https://issues.apache.org/jira/browse/HIVE-2482).)

使用提供的字符集(“us - ascii”，“iso -8859- 1”，“utf - 8”，“utf - 16be”，“utf - 16le”，“utf - 16”，“utf - 16”)将第一个参数编码为二进制。如果任一参数为空，则结果也为空( Hive [0.12.0](https://issues.apache.org/jira/browse/HIVE-2482))。intfield(val T,val1 T,val2 T,val3 T,...)
Returns the index of val in the val1,val2,val3,... list or 0 if not found. For example field('world','say','hello','world') returns 3.
All primitive types are supported, arguments are compared using str.equals(x). If val is NULL, the return value is 0.

(see [https://dev.mysql.com/doc/refman/5.7/en/string-functions.html/#function_field](https://dev.mysql.com/doc/refman/5.7/en/string-functions.html#function_field))

在val1,val2,val3中返回val的索引。如果在列表中没有找到则返回0。例如field(' world'，'say'，'hello'，'world ')，返回3。

所有原始类型都得到支持，参数使用str. equals(x)进行比较。如果val为NULL，则返回值为0。

(见[https://dev.mysql.com/doc/refman/5.7/en/string-functions.html](https://dev.mysql.com/doc/refman/5.7/en/string-functions.html) function_field)int

find_in_set(string str, string strList)

Returns the first occurance of str in strList where strList is a comma-delimited string. Returns null if either argument is null. Returns 0 if the first argument contains any commas. For example, find_in_set('ab', 'abc,b,ab,c,def') returns 3.

返回 strList 中第一个出现的str的索引值，其中strList是一个逗号分隔的字符串。如果参数为空，则返回null。如果第一个参数包含任何逗号，则返回0。例如，find_in_set(' ab '，' abc,b,ab,c,def ')返回3。string

format_number(number x, int d)

Formats the number X to a format like '/#,/#/#/#,/#/#/#./#/#', rounded to D decimal places, and returns the result as a string. If D is 0, the result has no decimal point or fractional part. (As of Hive [0.10.0](https://issues.apache.org/jira/browse/HIVE-2694); bug with float types fixed in [Hive 0.14.0](https://issues.apache.org/jira/browse/HIVE-7257), decimal type support added in [Hive 0.14.0](https://issues.apache.org/jira/browse/HIVE-7279))

将数字X格式化为 '/#,/#/#/#,/#/#/#./#/#'，四舍五入到D位小数，并以字符串的形式返回结果。如果D = 0，结果没有小数部分。(Hive [0.10.0](https://issues.apache.org/jira/browse/HIVE-2694);在Hive 0.14.0修复了单精度浮动类型的bug，Hive 0.14.0中添加了对小数类型的支持。string

get_json_object(string json_string, string path)

Extracts json object from a json string based on json path specified, and returns json string of the extracted json object. It will return null if the input json string is invalid. **NOTE: The json path can only have the characters [0-9a-z_], i.e., no upper-case or special characters. Also, the keys /*cannot start with numbers.**/* This is due to restrictions on Hive column names.

从基于json路径的json字符串提取json对象，并返回提取的json字符串。如果输入的json字符串无效，它将返回null。

注意: json路径只能有字符0 -9，a- z，即没有大写字母或特殊字符。而且键值不能从数字开始。这是由于对Hive列名的限制。boolean

in_file(string str, string filename)

Returns true if the string str appears as an entire line in filename.

如果字符串 str 为 filename 中的完整行，则返回true。int

instr(string str, string substr)

Returns the position of the first occurrence of

substr
in

str
. Returns

null
if either of the arguments are

null
and returns

0
if

substr
could not be found in

str
. Be aware that this is not zero based. The first character in

str
has index 1.

返回在str中第一次出现的子str的索引。如果其中所有参数都为null，则返回null，如果在str中找不到substr，则返回0。

请注意，索引不是基于零的。str的第一个字符索引值为1。int

length(string A)

Returns the length of the string.

返回字符串的长度。int

locate(string substr, string str[, int pos])

Returns the position of the first occurrence of substr in str after position pos.

在pos索引之后，返回第一次出现的substr的索引。string

lower(string A) lcase(string A)

Returns the string resulting from converting all characters of B to lower case. For example, lower('fOoBaR') results in 'foobar'.

返回将字符串 B 所有字符转换为小写字母的字符串。例如，lower(“fOoBaR”)的结果是“foobar”。string

lpad(string str, int len, string pad)

Returns str, left-padded with pad to a length of len. If str is longer than len, the return value is shortened to len characters. In case of empty pad string, the return value is null.

返回在 str 左边添加 pad 长度为len的字符串。如果str比len长，则返回值被缩短为len长度的字符。如果pad为空字符串，返回值为空。string

ltrim(string A)

Returns the string resulting from trimming spaces from the beginning(left hand side) of A. For example, ltrim(' foobar ') results in 'foobar '.

从字符串A的左边开始返回空格之后的字符串。例如，ltrim(' foobar ')的结果是' foobar '。array<struct<string,double>>

ngrams(array<array<string>>, int N, int K, int pf)

Returns the top-k N-grams from a set of tokenized sentences, such as those returned by the sentences() UDAF. See [StatisticsAndDataMining](https://cwiki.apache.org/confluence/display/Hive/StatisticsAndDataMining) for more information.

从一组标记化的句子中返回前k个连续出现的N个词语，例如用户自定义函数中sentences() 。有关更多信息，请参阅统计数据分析。intoctet_length(string str)
Returns the number of octets required to hold the string str in UTF-8 encoding (since Hive [2.2.0](https://issues.apache.org/jira/browse/HIVE-15979)). Note that octet_length(str) can be larger than character_length(str).

返回在utf - 8编码中保存字符串str所需的octets的数量(Hive 2.2.0)。注意，octet_length(str)可以大于字符长度(str)。string

parse_url(string urlString, string partToExtract [, string keyToExtract])

Returns the specified part from the URL. Valid values for partToExtract include HOST, PATH, QUERY, REF, PROTOCOL, AUTHORITY, FILE, and USERINFO. For example, parse_url('[http://facebook.com/path1/p.php?k1=v1&k2=v2/#Ref1](http://facebook.com/path1/p.php?k1=v1&k2=v2#Ref1)', 'HOST') returns '[facebook.com](http://facebook.com/)'. Also a value of a particular key in QUERY can be extracted by providing the key as the third argument, for example, parse_url('[http://facebook.com/path1/p.php?k1=v1&k2=v2/#Ref1](http://facebook.com/path1/p.php?k1=v1&k2=v2#Ref1)', 'QUERY', 'k1') returns 'v1'.

从URL返回指定部分。partToExtract的有效值包括HOST、PATH、QUERY、REF、PROTOCOL、AUTHORITY、FILE和USERINFO。

例如,parse_url([http://facebook.com/path1/p.php?k1](http://facebook.com/path1/p.php?k1) v2 = v1&k2 = /# Ref1”、“主机”)返回“[facebook.com](http://facebook.com/)”。也可以通过特定的键值查询，例如，通过提供键值提取url中的第三个参数,parse_url([http://facebook.com/path1/p.php?k1=v1&k2=v2/#Ref1](http://facebook.com/path1/p.php?k1=v1&k2=v2#Ref1)'，'查询'，' k1 ')返回' v1 '。string

printf(String format, Obj... args)

Returns the input formatted according do printf-style format strings (as of Hive [0.9.0](https://issues.apache.org/jira/browse/HIVE-2695)).

将入参按照printf格式返回(Hive 0.9.0)。string

regexp_extract(string subject, string pattern, int index)

Returns the string extracted using the pattern. For example, regexp_extract('foothebar', 'foo(./*?)(bar)', 2) returns 'bar.' Note that some care is necessary in using predefined character classes: using '\s' as the second argument will match the letter s; '\\s' is necessary to match whitespace, etc. The 'index' parameter is the Java regex Matcher group() method index. See [docs/api/java/util/regex/Matcher.html](https://docs.oracle.com/javase/8/docs/api/java/util/regex/Matcher.html) for more information on the 'index' or Java regex group() method.

返回使用pattern提取的字符串。例如,regexp_extract(“foothebar”、“foo(. /* ?)(bar),2)，返回bar。

在使用预定义字符类时需要注意：使用“\ s”作为第二个参数将与字母s匹配；“\ \ s”是匹配空格的必要条件，“index”参数是Java regex Matcher group()方法索引。见文[docs/api/java/util/regex/Matcher.html](https://docs.oracle.com/javase/8/docs/api/java/util/regex/Matcher.html)以获取更多关于“索引”或Java regex group()方法的信息。string

regexp_replace(string INITIAL_STRING, string PATTERN, string REPLACEMENT)

Returns the string resulting from replacing all substrings in INITIAL_STRING that match the java regular expression syntax defined in PATTERN with instances of REPLACEMENT. For example, regexp_replace("foobar", "oo|ar", "") returns 'fb.' Note that some care is necessary in using predefined character classes: using '\s' as the second argument will match the letter s; '\\s' is necessary to match whitespace, etc.

返回在INITIAL_STRING中替换所有子字符串的字符串，用于的替换字符串采用在REPLACEMENT中java正则表达式语法设计的PATTERN。string

repeat(string str, int n)

Repeats str n times.

返回重复str n次的字符串。stringreplace(string A, string OLD, string NEW)
Returns the string A with all non-overlapping occurrences of OLD replaced with NEW (as of [Hive 1.3.0 and 2.1.0](https://issues.apache.org/jira/browse/HIVE-13063)). Example: select replace("ababab", "abab", "Z"); returns "Zab".

返回A中使用字符串NEW代替字符串OLD后的字符串([Hive 1.3.0 and 2.1.0](https://issues.apache.org/jira/browse/HIVE-13063))。

例如：replace("ababab", "abab", "Z")返回 Zab。string

reverse(string A)

Returns the reversed string.

返回逆序后的字符串。string

rpad(string str, int len, string pad)

Returns str, right-padded with pad to a length of len. If str is longer than len, the return value is shortened to len characters. In case of empty pad string, the return value is null.

返回str右填充pad到len的长度的字符串。如果str比len长，则返回被缩短为len长度的字符串。如果pad为空，返回空值。string

rtrim(string A)

Returns the string resulting from trimming spaces from the end(right hand side) of A. For example, rtrim(' foobar ') results in ' foobar'.

返回从去掉字符串最右端空格的字符串。array<array<string>>

sentences(string str, string lang, string locale)

Tokenizes a string of natural language text into words and sentences, where each sentence is broken at the appropriate sentence boundary and returned as an array of words. The 'lang' and 'locale' are optional arguments. For example, sentences('Hello there! How are you?') returns ( ("Hello", "there"), ("How", "are", "you") ).

将一串自然语言文字转换成文字和句子，每句话在指定的边界被切分，返回切分一组词语。“lang”和“locale”是可选参数。

例如,sentences('Hello there! How are you?') 返回 ( ("Hello", "there"), ("How", "are", "you") )。string

space(int n)

Returns a string of n spaces.

返回n个空格的字符串。array

split(string str, string pat)

Splits str around pat (pat is a regular expression).

返回str被pat切分后的字符数组（其中pat是正则表达式）。map<string,string>

str_to_map(text[, delimiter1, delimiter2])

Splits text into key-value pairs using two delimiters. Delimiter1 separates text into K-V pairs, and Delimiter2 splits each K-V pair. Default delimiters are ',' for delimiter1 and ':' for delimiter2.

使用两个分隔符将文本分割成键值对。分隔符1将文本分隔成k - v对，分隔符2将每个k - v对分开。分隔符1的默认分隔符是“，”，分割符2的默认分隔符是“：”。string

substr(string|binary A, int start) substring(string|binary A, int start)

Returns the substring or slice of the byte array of A starting from start position till the end of string A. For example, substr('foobar', 4) results in 'bar' (see [[http://dev.mysql.com/doc/refman/5.0/en/string-functions.html/#function_substr](http://dev.mysql.com/doc/refman/5.0/en/string-functions.html#function_substr)]).

返回从start到A末尾的字符串。例如：substr('foobar', 4) 返回 'bar'（见[http://dev.mysql.com/doc/refman/5.0/en/string-functions.html/#function_substr](http://dev.mysql.com/doc/refman/5.0/en/string-functions.html#function_substr)）。string

substr(string|binary A, int start, int len) substring(string|binary A, int start, int len)

Returns the substring or slice of the byte array of A starting from start position with length len. For example, substr('foobar', 4, 1) results in 'b' (see [[http://dev.mysql.com/doc/refman/5.0/en/string-functions.html/#function_substr](http://dev.mysql.com/doc/refman/5.0/en/string-functions.html#function_substr)]).

返回从start开始之后len个字符A的子字符串。例如：substr('foobar', 4, 1) 返回'b' (见[http://dev.mysql.com/doc/refman/5.0/en/string-functions.html/#function_substr](http://dev.mysql.com/doc/refman/5.0/en/string-functions.html#function_substr))。stringsubstring_index(string A, string delim, int count)
Returns the substring from string A before count occurrences of the delimiter delim (as of Hive [1.3.0](https://issues.apache.org/jira/browse/HIVE-686)). If count is positive, everything to the left of the final delimiter (counting from the left) is returned. If count is negative, everything to the right of the final delimiter (counting from the right) is returned. Substring_index performs a case-sensitive match when searching for delim. Example: substring_index('[www.apache.org](http://www.apache.org/)', '.', 2) = '[www.apache'.]()

根据count值返回A的子字符串，如果count为正数，则返回从字符串A的左边到count个delim的子字符串，如果count为负数，则返回从字符串A的右边到count个delim的子字符串。string

translate(string|char|varchar input, string|char|varchar from, string|char|varchar to)

Translates the input string by replacing the characters present in the

from
string with the corresponding characters in the

to
string. This is similar to the

translate
function in [PostgreSQL](http://www.postgresql.org/docs/9.1/interactive/functions-string.html). If any of the parameters to this UDF are NULL, the result is NULL as well. (Available as of Hive [0.10.0](https://issues.apache.org/jira/browse/HIVE-2418), for string types)

Char/varchar support added as of [Hive 0.14.0](https://issues.apache.org/jira/browse/HIVE-6622).

将字符串input中的from字符串替换为to字符串。这类似于PostgreSQL中的转换函数。如果词函数所有参数都为NULL，则结果为NULL。(Hive 0.10.0支持string 类型)

Hive 0.14.0支持Char/ varchar。string

trim(string A)

Returns the string resulting from trimming spaces from both ends of A. For example, trim(' foobar ') results in 'foobar'

返回去除字符串两端的空格的字符串。例如：trim(' foobar ') 返回 'foobar'。binary

unbase64(string str)

Converts the argument from a base 64 string to BINARY. (As of Hive [0.12.0](https://issues.apache.org/jira/browse/HIVE-2482).)

将参数str从base64字符串转换为二进制(Hive [0.12.0](https://issues.apache.org/jira/browse/HIVE-2482))。string

upper(string A) ucase(string A)

Returns the string resulting from converting all characters of A to upper case. For example, upper('fOoBaR') results in 'FOOBAR'.

返回字符串A全部转化为大写的字符串。stringinitcap(string A)
Returns string, with the first letter of each word in uppercase, all other letters in lowercase. Words are delimited by whitespace. (As of Hive [1.1.0](https://issues.apache.org/jira/browse/HIVE-3405).)

返回每个单词的首字母大写，其他字母小写的字符串。单词被空格分隔(Hive [1.1.0](https://issues.apache.org/jira/browse/HIVE-3405))。intlevenshtein(string A, string B)
Returns the Levenshtein distance between two strings (as of Hive [1.2.0](https://issues.apache.org/jira/browse/HIVE-9556)). For example, levenshtein('kitten', 'sitting') results in 3.

返回两个字符串之间的Levenshtein距离(Hive 1.2.0)。例如， levenshtein('kitten', 'sitting') 返回 3。stringsoundex(string A)
Returns soundex code of the string (as of Hive [1.2.0](https://issues.apache.org/jira/browse/HIVE-9738)). For example, soundex('Miller') results in M460.

返回字符串的soundex代码(Hive 1.2.0)。例如，soundex(“Miller”)返回M460。

* 
### Data Masking Functions（数据加密函数）

在Hive中支持以下的数据加密函数：
**Return Type**

**Name(Signature)**

**Description**string

mask(string str[, string upper[, string lower[, string number]]])

Returns a masked version of str (as of Hive [2.1.0](https://issues.apache.org/jira/browse/HIVE-13568)). By default, upper case letters are converted to "X", lower case letters are converted to "x" and numbers are converted to "n". For example mask("abcd-EFGH-8765-4321") results in xxxx-XXXX-nnnn-nnnn. You can override the characters used in the mask by supplying additional arguments: the second argument controls the mask character for upper case letters, the third argument for lower case letters and the fourth argument for numbers. For example, mask("abcd-EFGH-8765-4321", "U", "l", "/#") results in llll-UUUU-/#/#/#/#-/#/#/#/#.

返回加密的str(如Hive 2.1.0)。默认情况下，大写字母被转换成“X”，小写字母被转换成“x”，数字被转换成“n”。例如，mask("abcd-EFGH-8765-4321")转化成xxxx-XXXX-nnnn-nnnn。可以通过提供额外的参数来指定加密使用的字符:第二个控制大小字母被加密成的字符、第三个和第四个参数分别控值小写字母和数字。

例如,mask("abcd-EFGH-8765-4321", "U", "l", "/#")返回 llll-UUUU-/#/#/#/#-/#/#/#/#。stringmask_first_n(string str[, int n])
Returns a masked version of str with the first n values masked (as of Hive [2.1.0](https://issues.apache.org/jira/browse/HIVE-13568)). Upper case letters are converted to "X", lower case letters are converted to "x" and numbers are converted to "n". For example, mask_first_n("1234-5678-8765-4321", 4) results in nnnn-5678-8765-4321.

返回从左边开始长度为n的部分加密字符串，加密规则是大写字母被转换成“X”，小写字母被转换成“x”，数字被转换成“n”。

例如： mask_first_n("1234-5678-8765-4321", 4) 返回 nnnn-5678-8765-4321。stringmask_last_n(string str[, int n])
Returns a masked version of str with the last n values masked (as of Hive [2.1.0](https://issues.apache.org/jira/browse/HIVE-13568)). Upper case letters are converted to "X", lower case letters are converted to "x" and numbers are converted to "n". For example, mask_last_n("1234-5678-8765-4321", 4) results in 1234-5678-8765-nnnn.

返回从右边开始长度为n的部分加密字符串，加密规则是大写字母被转换成“X”，小写字母被转换成“x”，数字被转换成“n”。

例如：mask_last_n("1234-5678-8765-4321", 4) 返回 1234-5678-8765-nnnn。stringmask_show_first_n(string str[, int n])
Returns a masked version of str, showing the first n characters unmasked (as of Hive [2.1.0](https://issues.apache.org/jira/browse/HIVE-13568)). Upper case letters are converted to "X", lower case letters are converted to "x" and numbers are converted to "n". For example, mask_show_first_n("1234-5678-8765-4321", 4) results in 1234-nnnn-nnnn-nnnn.

返回从左边开始n个字符不加密的字符串，加密规则是大写字母被转换成“X”，小写字母被转换成“x”，数字被转换成“n”。

例如： mask_show_first_n("1234-5678-8765-4321", 4) 返回1234-nnnn-nnnn-nnnn。stringmask_show_last_n(string str[, int n])
Returns a masked version of str, showing the last n characters unmasked (as of Hive [2.1.0](https://issues.apache.org/jira/browse/HIVE-13568)). Upper case letters are converted to "X", lower case letters are converted to "x" and numbers are converted to "n". For example, mask_show_last_n("1234-5678-8765-4321", 4) results in nnnn-nnnn-nnnn-4321.

返回从右边开始n个字符不加密的字符串，加密规则是大写字母被转换成“X”，小写字母被转换成“x”，数字被转换成“n”。

例如：mask_show_last_n("1234-5678-8765-4321", 4) 返回nnnn-nnnn-nnnn-4321。stringmask_hash(string|char|varchar str)
Returns a hashed value based on str (as of Hive [2.1.0](https://issues.apache.org/jira/browse/HIVE-13568)). The hash is consistent and can be used to join masked values together across tables. This function returns null for non-string types.

返回基于str的散列值字符串(Hive 2.1.0)。散列规则一致的，可以用于不同数据表之间的连接加密。对于空字符串，返回值为空。

* 
### Misc. Functions（混合函数）
**Return Type**

**Name(Signature)**

**Description**varies

java_method(class, method[, arg1[, arg2..]])

Synonym for

reflect
. (As of Hive [0.9.0](https://issues.apache.org/jira/browse/HIVE-1877).)

等同于 reflect。（Hive 0.9.0）varies

reflect(class, method[, arg1[, arg2..]])

Calls a Java method by matching the argument signature, using reflection. (As of Hive [0.7.0](https://issues.apache.org/jira/browse/HIVE-471).) See [Reflect (Generic) UDF](https://cwiki.apache.org/confluence/display/Hive/ReflectUDF) for examples.

根据参数利用反射调用相应的Java方法（ Hive [0.7.0](https://issues.apache.org/jira/browse/HIVE-471)）。见UDF中的 [Reflect (Generic)](https://cwiki.apache.org/confluence/display/Hive/ReflectUDF)。int

hash(a1[, a2...])

Returns a hash value of the arguments. (As of Hive 0.4.)

返回参数的哈希值。（Hive 0.4）stringcurrent_user()
Returns current user name from the configured authenticator manager (as of Hive [1.2.0](https://issues.apache.org/jira/browse/HIVE-9143)). Could be the same as the user provided when connecting, but with some authentication managers (for example HadoopDefaultAuthenticator) it could be different.

返回经配置的身份验证管理的当前用户名(Hive [1.2.0](https://issues.apache.org/jira/browse/HIVE-9143))。当连接是可能被分配成相同的用户名（如HadoopDefaultAuthenticator），但是可能不是由同一个身份管理器你产生的。stringlogged_in_user()
Returns current user name from the session state (as of Hive [2.2.0](https://issues.apache.org/jira/browse/HIVE-14100)). This is the username provided when connecting to Hive.

返回当前回话状态下的用户名（Hive 2.2.0）。对于已连接的Hive，其用户名就是登录时提供的用户名。stringcurrent_database()
Returns current database name (as of Hive [0.13.0](https://issues.apache.org/jira/browse/HIVE-4144)).

返回当前数据库名（Hive 0.13.0）。stringmd5(string/binary)
Calculates an MD5 128-bit checksum for the string or binary (as of Hive [1.3.0](https://issues.apache.org/jira/browse/HIVE-10485)). The value is returned as a string of 32 hex digits, or NULL if the argument was NULL. Example: md5('ABC') = '902fbdd2b1df0c4f70b4a5d23525e932'.

计算字符串或二进制的MD5 128位校验和(Hive 1.3.0)，并以以32十六进制数字字符串形式返回，如果参数为空，则返回NULL。

例子:md5(' ABC ')= 902 fbdd2b1df0c4f70b4a5d23525e932。string
sha1(string/binary)

sha(string/binary)

Calculates the SHA-1 digest for string or binary and returns the value as a hex string (as of Hive [1.3.0](https://issues.apache.org/jira/browse/HIVE-10639)). Example: sha1('ABC') = '3c01bdbb26f358bab27f267924aa2c9a03fcfdb8'.

使用安全散列算法1计算字符串或二进制的散列值，并以十六进制字符串形式返回(Hive 1.3.0). 例如：sha1('ABC') = '3c01bdbb26f358bab27f267924aa2c9a03fcfdb8'。bigintcrc32(string/binary)
Computes a cyclic redundancy check value for string or binary argument and returns bigint value (as of Hive [1.3.0](https://issues.apache.org/jira/browse/HIVE-10641)). Example: crc32('ABC') = 2743272264.

计算字符串或二进制参数的循环冗余校验值，并返回bigint值(Hive 1.3.0)。例如:crc32(ABC)= 2743272264。stringsha2(string/binary, int)
Calculates the SHA-2 family of hash functions (SHA-224, SHA-256, SHA-384, and SHA-512) (as of Hive [1.3.0](https://issues.apache.org/jira/browse/HIVE-10644)). The first argument is the string or binary to be hashed. The second argument indicates the desired bit length of the result, which must have a value of 224, 256, 384, 512, or 0 (which is equivalent to 256). SHA-224 is supported starting from Java 8. If either argument is NULL or the hash length is not one of the permitted values, the return value is NULL. Example: sha2('ABC', 256) = 'b5d4045c3f466fa91fe2cc6abe79232a1a57cdf104f7a26e716e0a1e2789df78'.

计算字符串或二进制参数的SHA-2 族（SHA-224, SHA-256, SHA-384, and SHA-512）（Hive 1.3.0）。第一个参数是要哈希的字符串或二进制。第二个参数表示结果的期望长度，它是224、256、384、512或0(相当于256)其中的一个。sha - 224从Java 8开始支持。如果参数为NULL或者散列长度不是允许的值，则返回值为空。binaryaes_encrypt(input string/binary, key string/binary)
Encrypt input using AES (as of Hive [1.3.0](https://issues.apache.org/jira/browse/HIVE-11593)). Key lengths of 128, 192 or 256 bits can be used. 192 and 256 bits keys can be used if Java Cryptography Extension (JCE) Unlimited Strength Jurisdiction Policy Files are installed. If either argument is NULL or the key length is not one of the permitted values, the return value is NULL. Example: base64(aes_encrypt('ABC', '1234567890123456')) = 'y6Ss+zCYObpCbgfWfyNWTw=='.

使用AES加密输入(Hive 1.3.0)。可以使用128、192或256位的密钥长度。如果安装了管理策略文件则Java加密扩展将不受长度限制，可以使用192和256位密钥。如果任一参数为NULL，或者key长度不是允许的值，则返回值为空。例如： base64(aes_encrypt('ABC', '1234567890123456')) = 'y6Ss+zCYObpCbgfWfyNWTw=='。binaryaes_decrypt(input binary, key string/binary)
Decrypt input using AES (as of Hive [1.3.0](https://issues.apache.org/jira/browse/HIVE-11593)). Key lengths of 128, 192 or 256 bits can be used. 192 and 256 bits keys can be used if Java Cryptography Extension (JCE) Unlimited Strength Jurisdiction Policy Files are installed. If either argument is NULL or the key length is not one of the permitted values, the return value is NULL. Example: aes_decrypt(unbase64('y6Ss+zCYObpCbgfWfyNWTw=='), '1234567890123456') = 'ABC'.

使用AES解密输入(Hive 1.3.0)。可以使用128、192或256位的密钥长度。如果安装了管理策略文件则Java加密扩展将不受长度限制，可以使用192和256位密钥。如果任一参数为NULL，或者key长度不是允许的值，则返回值为空。例如：aes_decrypt(unbase64('y6Ss+zCYObpCbgfWfyNWTw=='), '1234567890123456') = 'ABC'。stringversion()
Returns the Hive version (as of Hive [2.1.0](https://issues.apache.org/jira/browse/HIVE-12983)). The string contains 2 fields, the first being a build number and the second being a build hash. Example: "select version();" might return "2.1.0.2.5.0.0-1245 r027527b9c5ce1a3d7d0b6d2e6de2378fb0c39232". Actual results will depend on your build.

返回Hive版本(Hive 2.1.0)。该字符串包含两个字段，第一个是构建编号，第二个是构建散列。例如select version()可能返回2.1.0.2.5.0.0-1245 r027527b9c5ce1a3d7d0b6d2e6de2378fb0c39232，实际结果将依赖你的具体使用。

### xpath

The following functions are described in [LanguageManual XPathUDF](https://cwiki.apache.org/confluence/display/Hive/LanguageManual+XPathUDF):（下列函数的描述见[LanguageManual XPathUDF](https://cwiki.apache.org/confluence/display/Hive/LanguageManual+XPathUDF)）

* 
xpath, xpath_short, xpath_int, xpath_long, xpath_float, xpath_double, xpath_number, xpath_string

### get_json_object

A limited version of JSONPath is supported:

支持有限版本的JSONPath：

* 
$ : Root object 根对象
* 
. : Child operator 子操作符
* 
[] : Subscript operator for array 数组下标运算符
* 
/* : Wildcard for [] 通配符的[]

Syntax not supported that's worth noticing:

不支持的语法，值得注意:

* 
: Zero length string as key 键为长度为0的字符串
* 
.. : Recursive descent 递归下降
* 
@ : Current object/element 当前对象或元素
* 
() : Script expression 脚本表达式
* 
?() : Filter (script) expression. 过滤表达式
* 
[,] : Union operator 联合操作符
* 
[start:end.step] : array slice operator 数组切片操作符

Example: src_json table is a single column (json), single row table:

例如：src_json是一个由单行和单列组成的表：

+----+

json
+----+

{

"store"

:
{

"fruit"

:\[{

"weight"

:

8

,

"type"

:

"apple"

},{

"weight"

:

9

,

"type"

:

"pear"

}],

"bicycle"

:{

"price"

:

19.95

,

"color"

:

"red"

}
},

"email"

:

"amy@[only_for_json_udf_test.net](http://only_for_json_udf_test.net/)"

,
"owner"

:

"amy"

}
+----+

可以使用这些查询提取json对象的字段：
hive> SELECT get_json_object(src_json.json,

'$.owner'

) FROM src_json;

amy
hive> SELECT get_json_object(src_json.json,

'$.store.fruit\[0]'

) FROM src_json;

{

"weight"

:

8

,

"type"

:

"apple"

}
hive> SELECT get_json_object(src_json.json,

'$.non_exist_key'

) FROM src_json;

NULL

* 
## **Built-in Aggregate Functions (UDAF) 内置的聚合函数**

在Hive中支持以下内置聚合函数:
**Return Type**
**Name(Signature)**

**Description**BIGINT

count(/*), count(expr), count(DISTINCT expr[, expr...])

count(/*) - Returns the total number of retrieved rows, including rows containing NULL values.

返回检索行的总数，包括空值的行。

count(expr) - Returns the number of rows for which the supplied expression is non-NULL.

返回expr表达式不为空的行数。

count(DISTINCT expr[, expr]) - Returns the number of rows for which the supplied expression(s) are unique and non-NULL. Execution of this can be optimized with [hive.optimize.distinct.rewrite](https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-hive.optimize.distinct.rewrite).

返回满足表达式不为空的去重之后的行数。该操作可以使用hive.optimize.distinct.rewrite进行优化。DOUBLE

sum(col), sum(DISTINCT col)

Returns the sum of the elements in the group or the sum of the distinct values of the column in the group.

返回分组后元素的和，或分组后列去重之后的和。DOUBLE

avg(col), avg(DISTINCT col)

Returns the average of the elements in the group or the average of the distinct values of the column in the group.

返回分组后元素的平均值，或分组后列去重之后的平均值。DOUBLE

min(col)

Returns the minimum of the column in the group.

返回分组后列的最小值。DOUBLE

max(col)

Returns the maximum value of the column in the group.

返回分组后的最大值。DOUBLE

variance(col), var_pop(col)

Returns the variance of a numeric column in the group.

返回分组后数字列的方差。DOUBLE

var_samp(col)

Returns the unbiased sample variance of a numeric column in the group.

返回分组后数字列的无偏样本方差。DOUBLE

stddev_pop(col)

Returns the standard deviation of a numeric column in the group.

返回分组后数字列的标准差。DOUBLE

stddev_samp(col)

Returns the unbiased sample standard deviation of a numeric column in the group.

返回分组后数字列的无偏差样本标准差。DOUBLE

covar_pop(col1, col2)

Returns the population covariance of a pair of numeric columns in the group.

返回分组后两个数字列的总体协方差。DOUBLE

covar_samp(col1, col2)

Returns the sample covariance of a pair of a numeric columns in the group.

返回分组后两个数字列的样本协方差。Returns the sample covariance of a pair of a numeric columns in the group.DOUBLE

corr(col1, col2)

Returns the Pearson coefficient of correlation of a pair of a numeric columns in the group.

返回分组后两个数字列的Pearson系数。DOUBLE

percentile(BIGINT col, p)

Returns the exact pth percentile of a column in the group (does not work with floating point types). p must be between 0 and 1. NOTE: A true percentile can only be computed for integer values. Use PERCENTILE_APPROX if your input is non-integral.

返回分组后一个列确定第p百分位数(该操作不能用于浮点类型)。p必须在0到1之间。注意:一个确定的百分比只能计算为整数值。如果您的输入是非整数的，需要使用PERCENTILE_APPROX。array<double>

percentile(BIGINT col, array(p1 [, p2]...))

Returns the exact percentiles p1, p2, ... of a column in the group (does not work with floating point types). pi must be between 0 and 1. NOTE: A true percentile can only be computed for integer values. Use PERCENTILE_APPROX if your input is non-integral.

返回分组后一个列确定的第p1, p2, ...百分位数(该操作不能用于浮点类型)。pi必须在0到1之间。注意:一个确定的百分比只能计算为整数值。如果您的输入是非整数的，需要使用PERCENTILE_APPROX。DOUBLE

percentile_approx(DOUBLE col, p [, B])

Returns an approximate pth percentile of a numeric column (including floating point types) in the group. The B parameter controls approximation accuracy at the cost of memory. Higher values yield better approximations, and the default is 10,000. When the number of distinct values in col is smaller than B, this gives an exact percentile value.

返回分组后数值列(可以包括浮点类型)的近似第p个百分位数。B参数以内存开销为代价控制近似值，值越高产生近似月精确，默认值为10,000。当col的去重后值的个数小于B时，能计算出准确的百分位数。array<double>

percentile_approx(DOUBLE col, array(p1 [, p2]...) [, B])

Same as above, but accepts and returns an array of percentile values instead of a single one.

与上面相同，但是接受并返回一组百分位值，而不是单个值。double
regr_avgx(independent, dependent)

Equivalent to avg(dependent). As of [Hive 2.2.0](https://issues.apache.org/jira/browse/HIVE-15978).

等价于avg(dependent)，（[Hive 2.2.0](https://issues.apache.org/jira/browse/HIVE-15978)）。double
regr_avgy(independent, dependent)

Equivalent to avg(independent). As of [Hive 2.2.0](https://issues.apache.org/jira/browse/HIVE-15978).

等价于avg(independent)，（[Hive 2.2.0](https://issues.apache.org/jira/browse/HIVE-15978)）。double
regr_count(independent, dependent)

Returns the number of non-null pairs used to fit the linear regression line. As of [Hive 2.2.0](https://issues.apache.org/jira/browse/HIVE-15978).

返回用于适应线性回归的非空数值对的个数。double
regr_intercept(independent, dependent)

Returns the y-intercept of the [linear regression line](https://en.wikipedia.org/wiki/Linear_regression), i.e. the value of b in the equation dependent = a /* independent + b. As of [Hive 2.2.0](https://issues.apache.org/jira/browse/HIVE-15978).

返回线性回归线的y轴截距，即等式dependent = a /* independent + b中b的值(Hive 2.2.0)。double
regr_r2(independent, dependent)

Returns the [coefficient of determination](https://en.wikipedia.org/wiki/Coefficient_of_determination) for the regression. As of [Hive 2.2.0](https://issues.apache.org/jira/browse/HIVE-15978).

返回回归的确定系数(Hive 2.2.0)。double
regr_slope(independent, dependent)

Returns the slope of the [linear regression line](https://en.wikipedia.org/wiki/Linear_regression), i.e. the value of a in the equation dependent = a /* independent + b. As of [Hive 2.2.0](https://issues.apache.org/jira/browse/HIVE-15978).

返回线性回归线的斜率，即a在等式dependent = a /* independent + b中a的值。double
regr_sxx(independent, dependent)

Equivalent to regr_count(independent, dependent) /* var_pop(dependent). As of [Hive 2.2.0](https://issues.apache.org/jira/browse/HIVE-15978).

等价于 regr_count(independent, dependent) /* var_pop(dependent)(Hive 2.2.0)。double
regr_sxy(independent, dependent)

Equivalent to regr_count(independent, dependent) /* covar_pop(independent, dependent). As of [Hive 2.2.0](https://issues.apache.org/jira/browse/HIVE-15978).

等价于 regr_count(independent, dependent) /* covar_pop(independent, dependent) (Hive 2.2.0)。doubleregr_syy(independent, dependent)
Equivalent to regr_count(independent, dependent) /* var_pop(independent). As of [Hive 2.2.0](https://issues.apache.org/jira/browse/HIVE-15978).

等价于 regr_count(independent, dependent) /* var_pop(independent) (Hive 2.2.0)。array<struct {

'x','y'
}>

histogram_numeric(col, b)

Computes a histogram of a numeric column in the group using b non-uniformly spaced bins. The output is an array of size b of double-valued (x,y) coordinates that represent the bin centers and heights

在组中使用b非均匀间隔箱计算数字列的直方图。输出是一组大小为b的双值(x,y)坐标，分别代表了箱的中心和高度。array

collect_set(col)

Returns a set of objects with duplicate elements eliminated.

返回去除重复元素的列表。array

collect_list(col)

Returns a list of objects with duplicates. (As of Hive [0.13.0](https://issues.apache.org/jira/browse/HIVE-5294).)

返回带有重复元素的列表。INTEGERntile(INTEGER x)
Divides an ordered partition into

x
groups called buckets and assigns a bucket number to each row in the partition. This allows easy calculation of tertiles, quartiles, deciles, percentiles and other common summary statistics. (As of Hive [0.11.0](https://issues.apache.org/jira/browse/HIVE-896).)

将一个有序的分区切分成x个桶，并将每个bucket编号对应分区中的每一行。这样就可以很简单地计算出tertile、quartiles、deciles、percentiles和其他常见的汇总统计数据。 Hive [0.11.0](https://issues.apache.org/jira/browse/HIVE-896)()。

* 
## **Built-in Table-Generating Functions (UDTF)****内置表生成函数**

桶常的用户定义函数，如concat()，接受一个输入行，输出一个输出行。相反，表生成函数将单个输入行转换为多个输出行。
**Row-set columns types**

**Name(Signature)**

**Description**T

explode(ARRAY<T> a)

Explodes an array to multiple rows. Returns a row-set with a single column (*col*), one row for each element from the array.

将数组转化为表。返回一个行集，其中只包含一个列，其中一行对应于数组中的每个元素。Tkey,Tvalue

explode(MAP<Tkey,Tvalue> m)

Explodes a map to multiple rows. Returns a row-set with a two columns (*key,value)* , one row for each key-value pair from the input map. (As of Hive [0.8.0](https://issues.apache.org/jira/browse/HIVE-1735).).

将键值对转化表。返回一个两个列(key,value)的行集，每个行的m中的一个键值对。(Hive 0.8.0。)。int,Tposexplode(ARRAY<T> a)
Explodes an array to multiple rows with additional positional column of *int* type (position of items in the original array, starting with 0). Returns a row-set with two columns (*pos,val*), one row for each element from the array.

将数组转化为表，表的行除了数组的元素外，额外添加了一个整数用于记录列索引（从0开始）。T1,...,Tn

inline(ARRAY<STRUCT<f1:T1,...,fn:Tn>> a)

Explodes an array of structs to multiple rows. Returns a row-set with N columns (N = number of top level elements in the struct), one row per struct from the array. (As of Hive [0.10](https://issues.apache.org/jira/browse/HIVE-3238).)

将结构体数组转化为表，该表包含N个列(N是结构体包含的字段数量)，表的每行表示数组中的每个结构体。(Hive 0.10)。T1,...,Tn/rstack(int r,T1V1,...,Tn/rVn)
Breaks up *n* values V1,...,Vn into *r*rows. Each row will have *n/r*columns. *r*must be constant.

n个值 V1,...,Vn分成r行。每一行都有n / r列。r必须是常数。string1,...,stringn

json_tuple(string jsonStr,string k1,...,string kn)

Takes JSON string and a set of *n* keys, and returns a tuple of *n* values. This is a more efficient version of the

get_json_object
UDF because it can get multiple keys with just one call.

提取 jsonStr的n个键值以n元祖的形式返回。这是get_json_object 的一个更有效的版本，因为它只需要一个调用就可以得到多个键。string 1,...,stringn

parse_url_tuple(string urlStr,string p1,...,string pn)

Takes URL string and a set of *n* URL parts, and returns a tuple of *n* values. This is similar to the

parse_url()
UDF but can extract multiple parts at once out of a URL. Valid part names are: HOST, PATH, QUERY, REF, PROTOCOL, AUTHORITY, FILE, USERINFO, QUERY:<KEY>.

提取urlStr 的n个字段并以n元祖的形式返回。这类似于

parse_url()
，但可以立即从URL中提取多个部分。有效字段名为：HOST, PATH, QUERY, REF, PROTOCOL, AUTHORITY, FILE, USERINFO, QUERY:<KEY>。