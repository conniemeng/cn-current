**业务架构**

本部分将介绍基于京东云部署ALG类型应用服务的业务架构。本文档以FTP服务以及FTP被动模式进行说明。被动模式下，FTP服务器会通过response告知客户端其IP地址以及端口号。在云环境下，FTP服务器面向公网提供服务时，需要进行网络层的NAT转换，但是该NAT并不具备ALG功能，导致response报文中应用层返回的IP地址为FTP服务器的内网IP地址，从而客户端无法与FTP服务器建立有效的数据连接。

![架构图04副本.png](https://img1.jcloudcs.com/cms/8638e57f-e887-4588-ab9d-911ce471c9b020180712200624.png)

图1 ALG类型应用部署架构图

**实验步骤概览**

**步骤1**：登录京东云控制台，创建2个私有网络（VPC），分别命名为私有网络1与私有网络2。

**步骤2**：在私有网络1与私有网络2中分别创建1个子网，并为每个子网配置合适的ACL。

**步骤3**：在私有网络1的子网内创建FTP服务器，设置合适的安全组策略，并为该服务器分配2个内网IP地址，2个内网IP地址分别绑定公网IP地址。

**步骤4**：在私有网络2的子网内创建FTP客户端，设置合适的安全组策略，并为该服务器的内网IP地址绑定公网IP地址。

**步骤5**：在FTP服务器中部署FTP服务。

**步骤6**：在FTP客户端中安装FileZilla软件，用于与FTP服务器建立连接。

**步骤7**：在FTP服务器中使用iptables工具对云主机进行配置。

**步骤8**：验证FTP客户端与FTP服务器之间的数据连接。

以上实验步骤为操作步骤概览，本文档后续部分将介绍配置的详细步骤。